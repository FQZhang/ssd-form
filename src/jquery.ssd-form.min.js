/*
 * ssdForm jQuery plugin
 * Examples and documentation at: https://github.com/sebastiansulinski/ssd-form
 * Copyright (c) 2017 Sebastian Sulinski
 * Version: 1.4.0 (13-MAY-2017)
 * Licensed under the MIT.
 * Requires: jQuery v1.9 or later
 */
!function(a,b){"function"==typeof define&&define.amd?define(["jquery"],function(a){return b(a)}):"object"==typeof exports?module.exports=b(require("jquery")):b(a.jQuery)}(this,function(a){!function(){"use strict";a.fn.ssdForm=function(b){var c=a.extend({dataFormWrapper:"data-form-wrapper",dataConfirmation:"data-confirmation",dataValidationSegment:"data-validation",dataValidationCase:"data-case",dataSubmitTrigger:"data-submit-trigger",dataSubmitPending:"data-submit-pending",classHide:"hide",classShow:"show",extendBehaviours:{},extendValidationRules:{},postAjaxSuccess:function(a,b,c){a.successBehaviour(b,c)},postAjaxFailure:function(a,b,c,d,e){a.endRequestDisplayErrors(b,c.responseJSON)},ignoreElements:".button, [disabled]",serializeAttribute:null,actionMethod:function(b,c,d,e){a.ajax({method:c.method(),url:c.action(),data:c.data(),dataType:"json",cache:!1,success:d,error:e})}},b),d="["+c.dataFormWrapper+"]",e="["+c.dataConfirmation+"]",f="["+c.dataValidationSegment+"]",g="["+c.dataValidationCase+"]",h="["+c.dataSubmitTrigger+"]",i="["+c.dataSubmitPending+"]",j=function(){var a={};this.add=function(b,c){if(a.hasOwnProperty(b))return!1;a[b]=c},this.all=function(){return a},this.empty=function(){return 0===Object.keys(a).length}},k={replace:function(b){void 0!==b.replace&&a.each(b.replace,function(b,c){a("[data-"+b+"]").html(c)})},remove:function(b){void 0!==b.remove&&a.each(b.remove,function(b,c){a("[data-"+c+"]").remove()})},reload:function(){window.location.reload(!0)},redirect:function(a){window.location.href=a}},l=a.extend({elements:[],required:function(a){return!(""===a.value||null===a.value||void 0===a.value)},checked:function(a){return a.isChecked},value_is:function(a){return a.value===a.rules_collection[0]},email:function(a){return/^[a-zA-Z0-9._\-]+@[a-zA-Z0-9]+([.\-]?[a-zA-Z0-9]+)?([\.]{1}[a-zA-Z]{2,4}){1,4}$/.test(a.value)},password:function(a){return/(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,}/.test(a.value)},min:function(a){return a.value.length>=a.rules_collection[0]},max:function(a){return a.value.length<=a.rules_collection[0]},confirmed:function(a){var b=a.name+"_confirmation",c=this.elements.filter(function(a,c){return c.name===b})[0];if(0===c.length)throw new Error(a.name+"_confirmation field is missing");return c.value===a.value},regex:function(a){return new RegExp(a.rules_collection[0]).test(a.value)},test:function(b,c){var d=this,e=a.Deferred();return d.elements=b,a.each(c.rules,function(a,b){var f=b.split(":"),g=f.shift();c.rules_collection=f,d[g](c)||e.reject(g),a+1===c.rules.length&&e.resolve()}),e.promise()}},c.extendValidationRules),m=function(b,d){function e(a){return a.isVisible||a.isEditor}function f(b,c){return-1===a.inArray("required",c.rules)&&""===c.value||l.test(b,c)}function g(a,b,c){a+1===b&&(d.empty()?c.resolve():c.reject(d.all()))}if(!(b instanceof o))throw new Error("Invalid argument form_model.");if(!(d instanceof j))throw new Error("Invalid argument error.");this.run=function(){var h=b.inputs(),i=h.length,j=a.Deferred();return a.each(h,function(b,k){var l=a(this),m={instance:l,name:null===c.serializeAttribute?l.prop("name"):l.attr(c.serializeAttribute),type:l.prop("type"),value:l.prop("value"),rules:l.data("validate"),isChecked:l.is(":checked"),isVisible:l.is(":visible"),isEditor:l.hasClass("editor")};return e(m)?void 0===m.rules||0===m.rules.length?(g(b,i,j),!0):(m.rules=m.rules.split("|"),void a.when(f(h,m)).done(function(){g(b,i,j)}).fail(function(a){d.add(m.name,a),g(b,i,j)})):(g(b,i,j),!0)}),j.promise()}},n=a.extend({redirect:function(a,b){if(!b.redirect)throw new Error("Redirect entry missing.");k.redirect(b.redirect)},reload:function(){k.reload()},fadeOutShowMessage:function(a,b){var c=a.instance().closest(d),f=c.find(e);a.instance().fadeOut(200,function(){f.html(b.message).fadeIn(200)})},fadeOutShowMessageRedirect:function(a,b){var c=a.instance().closest(d),f=c.find(e);a.instance().fadeOut(200,function(){f.html(b.message).fadeIn(200,function(){setTimeout(function(){window.location.href=b.redirect},3e3)})})},fadeOutShowMessageReload:function(a,b){var c=a.instance().closest(d),f=c.find(e);a.instance().fadeOut(200,function(){f.html(b.message).fadeIn(200,function(){setTimeout(function(){window.location.reload(!0)},3e3)})})},fadeOutShowMessageResetFadeIn:function(a,b){var c=a.instance().closest(d),f=c.find(e);a.instance().fadeOut(200,function(){p.endRequest(a),f.html(b.message).fadeIn(200),setTimeout(function(){f.fadeOut(200,function(){a.instance()[0].reset(),a.instance().fadeIn(200)})},3e3)})},callReplaceRemove:function(a,b){k.replace(b),k.remove(b)},ask:function(a,b){if(!this.hasOwnProperty(b.behaviour))throw new Error("Behaviour not specified.");this[b.behaviour](a,b)},run:function(a,b){var c=a.successBehaviour();if(!this.hasOwnProperty(c))throw new Error("Behaviour does not exist.");this[c](a,b)}},c.extendBehaviours),o=function(b){function h(){var b=[];return d.each(function(){var d=a(this).attr(c.serializeAttribute),e=a(this).val();b.push({name:d,value:e})}),b}function i(){if(void 0===e.method&&(e.method="post"),void 0===e.action)throw new Error("No action defined.")}var f,g,d=b.find(":input").not(c.ignoreElements),e={method:b.prop("method"),action:b.prop("action"),successBehaviour:b.data("success-behaviour"),inputs:d,data:null===c.serializeAttribute?b.serializeArray():h()};i(),this.instance=function(){return b},this.method=function(){return e.method},this.action=function(){return e.action},this.successBehaviour=function(){return e.successBehaviour},this.inputs=function(){return e.inputs},this.data=function(){return e.data},this.validate=function(){return g=new j,f=new m(this,g),f.run()},this.reset=function(){b.trigger("reset")}},p={clearErrors:function(a){a.instance().find(f+" "+g).removeClass(c.classShow)},displayAlert:function(a){},displayErrors:function(b,d){var e;for(var f in d)if(d.hasOwnProperty(f)){if("alert"==f){this.displayAlert(d[f]);continue}e=a.isArray(d[f])?d[f][0]:d[f],b.instance().find("["+c.dataValidationSegment+'="'+f+'"] ['+c.dataValidationCase+'="'+e+'"]').addClass(c.classShow)}},beginRequest:function(a){if(a.instance().data("quiet"))return!0;a.instance().find(h).addClass(c.classHide),a.instance().find(i).removeClass(c.classHide)},endRequest:function(a){if(a.instance().data("quiet"))return!0;a.instance().find(h).removeClass(c.classHide),a.instance().find(i).addClass(c.classHide)},successBehaviour:function(a,b){n.run(a,b)},disableForm:function(a){this.submitted=a},enableForm:function(){this.submitted=null},endRequestDisplayErrors:function(a,b){this.endRequest(a),this.displayErrors(a,b)},endRequestDisplayErrorsReset:function(a,b){this.endRequestDisplayErrors(a,b),a.reset()},formAction:function(b,d,e,f){var g=this;a.when(b.validate()).done(function(a,f,h){g.beginRequest(b),c.actionMethod(g,b,d,e)}).fail(f)},submit:function(b){var d=this;a(b).on("submit",function(b){b.preventDefault();var e=new o(a(this));d.clearErrors(e),d.formAction(e,function(a){c.postAjaxSuccess(d,e,a)},function(a,b,f){c.postAjaxFailure(d,e,a,b,f)},function(a){d.endRequestDisplayErrors(e,a)})})},clickSubmit:function(){a(document).on("click",".clickSubmit",function(b){b.preventDefault(),b.stopPropagation();var c=a(this).data("target");a(c).submit()})},init:function(a){this.submit(a),this.clickSubmit()}};return p.init(this)}}()});