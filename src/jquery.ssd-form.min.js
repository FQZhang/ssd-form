/*
 * ssdForm jQuery plugin
 * Examples and documentation at: https://github.com/sebastiansulinski/ssd-form
 * Copyright (c) 2016 Sebastian Sulinski
 * Version: 1.0.0 (02-APR-2016)
 * Licensed under the MIT.
 * Requires: jQuery v1.9 or later
 */
!function(e,t,n){"use strict";t.fn.ssdForm=function(i){var a=t.extend({dataFormWrapper:"data-form-wrapper",dataConfirmation:"data-confirmation",dataValidationSegment:"data-validation",dataValidationCase:"data-case",dataSubmitTrigger:"data-submit-trigger",dataSubmitPending:"data-submit-pending",classHide:"hide",classShow:"show"},i),r=("["+a.dataFormWrapper+"]","["+a.dataConfirmation+"]"),s="["+a.dataValidationSegment+"]",o="["+a.dataValidationCase+"]",u="["+a.dataSubmitTrigger+"]",c="["+a.dataSubmitPending+"]",d=function(){var e={};this.add=function(t,n){return e.hasOwnProperty(t)?!1:void(e[t]=n)},this.all=function(){return e},this.empty=function(){return 0===Object.keys(e).length}},l={replace:function(e){e.replace!==n&&t.each(e.replace,function(e,n){t("[data-"+e+"]").html(n)})},remove:function(e){e.remove!==n&&t.each(e.remove,function(e,n){t("[data-"+n+"]").remove()})},reload:function(){e.location.reload(!0)},redirect:function(t){e.location.href=t}},f={elements:[],required:function(e){return!(""===e.value||null===e.value||e.value===n)},checked:function(e){return e.isChecked},value_is:function(e){return e.value==e.rules_collection},email:function(e){var t=/^[a-zA-Z0-9._\-]+@[a-zA-Z0-9]+([.\-]?[a-zA-Z0-9]+)?([\.]{1}[a-zA-Z]{2,4}){1,4}$/;return t.test(e.value)},password:function(e){var t=/(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,}/;return t.test(e.value)},min:function(e){return e.value.length>=e.rules_collection},max:function(e){return e.value.length<=e.rules_collection},confirmed:function(e){var t=e.name+"_confirmation",n=this.elements.filter(function(e,n){return n.name===t})[0];if(0===n.length)throw new Error(e.name+"_confirmation field is missing");return n.value===e.value},test:function(e,n){var i=this,a=t.Deferred();return i.elements=e,t.each(n.rules,function(e,t){var r=t.split(":"),s=r.shift();n.rules_collection=r,i[s](n)||a.reject(s),e+1==n.rules.length&&a.resolve()}),a.promise()}},h=function(e,i){function a(e){return e.isVisible||e.isEditor}function r(e,n){return-1===t.inArray("required",n.rules)&&""==n.value?!0:f.test(e,n)}function s(e,t,n){e+1===t&&(i.empty()?n.resolve():n.reject(i.all()))}var o=".button, [disabled]";if(!(e instanceof v))throw new Error("Invalid argument form.");if(!(i instanceof d))throw new Error("Invalid argument error.");this.run=function(){var u=e.instance().find(":input").not(o),c=u.length,d=t.Deferred();return t.each(u,function(e,o){var l=t(this),f={instance:l,name:l.prop("name"),type:l.prop("type"),value:l.prop("value"),rules:l.data("validate"),isChecked:l.is(":checked"),isVisible:l.is(":visible"),isEditor:l.hasClass("editor")};return a(f)?f.rules===n||0===f.rules.length?(s(e,c,d),!0):(f.rules=f.rules.split("|"),void t.when(r(u,f)).done(function(){s(e,c,d)}).fail(function(t){i.add(f.name,t),s(e,c,d)})):(s(e,c,d),!0)}),d.promise()}},m={redirect:function(e,t){if(!t.redirect)throw new Error("Redirect entry missing.");l.redirect(t.redirect)},reload:function(){l.reload()},fadeOutShowMessage:function(e,t){p.endRequest(e);var n=e.instance().closest(n),i=n.find(r);e.instance().fadeOut(200,function(){i.html(t.message).fadeIn(200)})},fadeOutShowMessageRedirect:function(t,n){p.endRequest(t);var i=t.instance().closest(i),a=i.find(r);t.instance().fadeOut(200,function(){a.html(n.message).fadeIn(200,function(){setTimeout(function(){e.location.href=n.url},3e3)})})},fadeOutShowMessageResetFadeIn:function(e,t){p.endRequest(e);var n=e.instance().closest(n),i=n.find(r);e.instance().fadeOut(200,function(){i.html(t.message).fadeIn(200),setTimeout(function(){i.fadeOut(200,function(){e.instance()[0].reset(),e.instance().fadeIn(200)})},3e3)})},callReplaceRemove:function(e,t){l.replace(t),l.remove(t)},ask:function(e,t){if(!this.hasOwnProperty(t.behaviour))throw new Error("Behaviour not specified.");this[t.behaviour](e,t)},run:function(e,t){var n=e.successBehaviour();if(!this.hasOwnProperty(n))throw new Error("Behaviour does not exist.");this[n](e,t)}},v=function(e){function t(){if(r.method===n&&(r.method="post"),r.action===n)throw new Error("No action defined.")}var i,a,r={method:e.prop("method"),action:e.prop("action"),successBehaviour:e.data("success-behaviour"),data:e.serializeArray()};t(),this.instance=function(){return e},this.method=function(){return r.method},this.action=function(){return r.action},this.successBehaviour=function(){return r.successBehaviour},this.data=function(){return r.data},this.validate=function(){return a=new d,i=new h(this,a),i.run()},this.reset=function(){e.trigger("reset")}},p={clearErrors:function(e){e.instance().find(s+" "+o).removeClass(a.classShow)},displayAlert:function(e){},displayErrors:function(e,n){var i;for(var r in n)if(n.hasOwnProperty(r)){if("alert"==r){this.displayAlert(n[r]);continue}i=t.isArray(n[r])?n[r][0]:n[r],e.instance().find("["+a.dataValidationSegment+'="'+r+'"] ['+a.dataValidationCase+'="'+i+'"]').addClass(a.classShow)}},beginRequest:function(e){return e.instance().data("quiet")?!0:(e.instance().find(u).addClass(a.classHide),void e.instance().find(c).removeClass(a.classHide))},endRequest:function(e){return e.instance().data("quiet")?!0:(e.instance().find(u).removeClass(a.classHide),void e.instance().find(c).addClass(a.classHide))},successBehaviour:function(e,t){m.run(e,t)},disableForm:function(e){this.submitted=e},enableForm:function(){this.submitted=null},endRequestDisplayErrors:function(e,t){this.endRequest(e),this.displayErrors(e,t)},endRequestDisplayErrorsReset:function(e,t){this.endRequestDisplayErrors(e,t),e.reset()},formAction:function(e,n,i,a){var r=this;t.when(e.validate()).done(function(a,s,o){r.beginRequest(e),t.ajax({method:e.method(),url:e.action(),data:e.data(),dataType:"json",cache:!1,success:n,error:i})}).fail(a)},submit:function(e){var n=this;t(e).on("submit",function(e){e.preventDefault();var i=new v(t(this));n.clearErrors(i),n.formAction(i,function(e){n.successBehaviour(i,e)},function(e,t,a){n.endRequestDisplayErrors(i,e.responseJSON)},function(e){n.endRequestDisplayErrors(i,e)})})},clickSubmit:function(){t(document).on("click",".clickSubmit",function(e){e.preventDefault(),e.stopPropagation();var n=t(this).data("target");t(n).submit()})},init:function(e){this.submit(e),this.clickSubmit()}};return p.init(this)}}(window,window.jQuery);